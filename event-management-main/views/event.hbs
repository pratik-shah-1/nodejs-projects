<div class="shadow p-4 border rounded event_details">
	{{!-- <!-- Event-Image-Name-Basic-Info --> --}}
	<div class="d-flex justify-content-between event_details_all">
		{{!-- <!-- Event Name-Image --> --}}
		<div class="event_details_img">
			<img class="img-fluid rounded" src="{{event.image}}" alt="">
			<p class="m-0 h5 py-2 text-capitalize">{{event.name}} </p>
			{{!-- Is Event Expired --}}
			{{#if event.expire}}
				{{#if event_manager}}
				<a href="/regenerate_event/{{event.slug}}" class="btn btn-sm btn-info"><span class="h6">REGENERATE</span></a>
				{{else}}
				<p class="m-0 h5 p-2 px-3 rounded bg-danger text-light" style="width:110px;">EXPIRED</p>
				{{/if}}	
			{{else if event.cancel}} {{!-- is Event Cancel --}}
				<p class="m-0 h5 p-2 px-3 rounded bg-info text-light" style="width:130px;">CANCELED</p>
			{{/if}}
			<p class="m-0 h5 py-2 text-uppercase">{{event.type}}</p>
			{{#if event.price}}
				<p class="m-0 h5 py-2 text-capitalize">Price : â‚¹{{event.amount}}</p>
			{{/if}}
		</div>
		{{!-- <!-- Event Details --> --}}
		<div class="d-flex flex-column mr-sm-5 pr-sm-5 event_details_info">
			<p class="h6 my-2 mb-3 d-flex align-items-center border_left_4">
				<span class="px-2" style="width:125px;">CATEGORY</span>
				<span class="px-2">:</span>		  
				<span class="text-capitalize">{{event.category}}</span>
			</p>	
			<p class="h6 my-2 mb-3 d-flex align-items-center border_left_4">
				<span class="px-2" style="width:125px;">TIME</span>
				<span class="px-2">:</span>		  
				<span>{{event.start_time}} - {{event.end_time}}</span>
			</p>	
			<p class="h6 my-2 mb-3 d-flex align-items-center border_left_4">
				<span class="px-2" style="width:125px;">LOCATION</span>
				<span class="px-2">:</span>		  
				<span class="text-capitalize">{{event.location}}</span>
			</p>	
			<p class="h6 my-2 mb-3 d-flex align-items-center border_left_4">
				<span class="px-2" style="width:125px;">START</span>
				<span class="px-2">:</span> 
				<span>{{event.start_date}}</span>
			</p>
			<p class="h6 my-2 mb-3 d-flex align-items-center border_left_4">
				<span class="px-2" style="width:125px;">END</span>
				<span class="px-2">:</span>
				<span>{{event.end_date}}</span>
			</p>
			<p class="h6 my-2 mb-3 d-flex align-items-center border_left_4">
				<span class="px-2" style="width:125px;">CAPACITY</span>
				<span class="px-2">:</span>
				<span>{{event.capacity}}</span>
			</p>
			<p class="h6 my-2 mb-3 d-flex align-items-center border_left_4">
				<span class="px-2" style="width:125px;">CERTIFICATE</span>
				<span class="px-2">:</span>		  
				{{#if event.certificate}}
					<span class="text-capitalize">Will Provide</span>
				{{else}}
					<span class="text-capitalize">Not Provide</span>					
				{{/if}}
			</p>	
			<p class="h6 my-2 mb-3 d-flex align-items-center border_left_4">
				<span class="px-2" style="width:125px;">WINNER PRIZE</span>
				<span class="px-2">:</span>		  
				{{#if event.winner}}
					<span class="text-capitalize">Yes</span>
				{{else}}
					<span class="text-capitalize">No</span>					
				{{/if}}
			</p>	
		</div>{{!-- <!-- End Evnet Details --> --}}
	</div>{{!-- <!-- End of Basic Info --> --}}
	
	{{!-- <!-- Participate Button --> --}}
	{{#unless event.expire}}
		{{#unless event.cancel}}	
			<div class="mt-3 d-flex justify-content-start">
			{{!-- If Event Expire then not not show any button --}}
				{{#if student}}
					{{#if event.participated}}
						<button class="btn btn-primary" disabled>
							<span class="h6">PARTICIPATED</span>
						</button>
					{{else}}
						<button class="btn btn-warning" onclick="participate_popup(this)" value="{{event._id}}"><span class="h6">PARTICIPATE</span></button>
					{{/if}}
				{{else if volunteer}}
					{{#if event.pending}}
						<button class="btn btn-warning" disabled>
							<span class="h6">PENDING</span>
						</button>			
		 			{{else if event.accepted}}
						<button class="btn btn-primary" disabled>
							<span class="h6">MEMBER</span>
						</button>
		 			{{else if event.rejected}}
						<button class="btn btn-danger" disabled>
							<span class="h6">REJECTED</span>
						</button>
		 			{{else}}
						<button class="btn btn-warning" onclick="volunteer_request_popup(this)" value="{{event._id}}">
							<span class="h6">BE VOLUNTEER</span>
						</button>
					{{/if}}			
				{{/if}}	
			</div>
		{{/unless}}
	{{/unless}}
	{{!--  Event Details --}}
	<div class="mt-4">
		<p class="h5" style="border-left:5px solid black;"><span class="px-2 py-3">Details</span></p>
		<p class="h5 font-weight-normal" style="line-height:35px;">{{event.details}}</p>
	</div>
	{{!--  Contact  --}}
	{{#if event.person_name}}
		<div class="mt-4">
			<span class="h5 border_left_5"><span class="px-2">Contact</span></span>
			<div class="mt-3 d-flex flex-column">
				<p class="d-flex h6">
					<span class="h6 text-capitalize">{{event.person_name}}</span>
					<span class="px-2">:</span>
					<span>{{event.person_mobile}}</span>	
				</p>
			</div>
		</div>
	{{/if}}
	{{!-- Feedback --}}
	<div class="mt-4">
		{{!-- For Participant --}}
		{{#if event.participated}}
			{{#if event.expire}}
				<p class="h5 border_left_5"><span class="px-2">Feedback</span></p>
				<div class="mt-4 p-0">
					<textarea name="feedback" class="form-control" placeholder="Write Feedback Here" style="height:100px;"></textarea>
					<button class="btn btn-primary mt-3" onclick="post_feedback();"><span class="h6">POST</span></button>
				</div>
			{{/if}}
		{{!-- For Volunteer --}}
		{{else if event.accepted}}
			<p class="h5 border_left_5"><span class="px-2">Feedback</span></p>
			<div class="mt-4 p-0">
				<textarea name="feedback" class="form-control" placeholder="Write Feedback Here" style="height:100px;"></textarea>
				<button class="btn btn-primary mt-3" onclick="post_feedback();"><span class="h6">POST</span></button>
			</div>
		{{else if event.my_event}}
			<p class="h5 border_left_5"><span class="px-2">Feedback</span></p>
			<div class="mt-4 p-0">
				<textarea name="feedback" class="form-control" placeholder="Write Feedback Here" style="height:100px;"></textarea>
				<button class="btn btn-primary mt-3" onclick="post_feedback();"><span class="h6">POST</span></button>
			</div>
		{{/if}}
		<div class="mt-4 p-0">
			<div class="row feedback">
				{{!-- Feedback also see by guest user --}}
				{{#each feedback}}
					{{#if this.student}}
						<div class="col-lg-4 col-md-4 col-sm-6 col-12">
							<div class="shadow-sm border rounded m-1 mb-4 overflow-auto" style="height:200px;">
								<p class="h5 p-3 px-4 border-bottom">{{this.student.name}}</p>
								<p class="px-4 " style="line-height:30px">{{this.feedback}}</p>
							</div>					
						</div>
					{{else if this.event_manager}}
						<div class="col-lg-4 col-md-4 col-sm-6 col-12">
							<div class="shadow-sm border rounded m-1 mb-4 overflow-auto" style="height:200px;">
								<p class="h5 p-3 px-4 bg-dark text-light">{{this.event_manager.name}}</p>
								<p class="px-4 " style="line-height:30px">{{this.feedback}}</p>
							</div>					
						</div>
					{{else if this.volunteer}}
						<div class="col-lg-4 col-md-4 col-sm-6 col-12">
							<div class="shadow-sm border rounded m-1 mb-4 overflow-auto" style="height:200px;">
								<p class="h5 p-3 px-4 bg-dark text-light">{{this.volunteer.name}}</p>
								<p class="px-4 " style="line-height:30px">{{this.feedback}}</p>
							</div>					
						</div>
					{{/if}}
				{{/each}}
			</div>
		</div>
	</div>
</div>

<input type="hidden" value="{{_token}}" name="_token">

<script>

	function isLogged(){
		if(`{{logged}}`=='true'){
			return true;
		}
		else{
			swal('You need login','','warning');
		}
	}

	function participate(event_id){
		const payment = $('[name="payment_participate"]').val();
		const _token = $('[name="_token"]').val();
		const event = event_id;
		const btn = temp;
		if(isLogged()){
			swal({
			  	title: "Are you sure?",
			  	icon: "warning",
			  	buttons: true
			})
			.then((res) => {
			  	if(res){
					$.ajax({
						url : '/participate',
						method : 'POST',
						data: {event, _token, payment},
						success : function(res){
							if(res){
								//CLOSE POPUP BUTTON
						  		$('body').css({'height':'auto','overflow':'auto'});
						  		$('.random').removeClass('backlight');
						  		$('.participate_popup').addClass('d-none');		
								btn.parentElement.outerHTML = `
								<button class="btn btn-primary" disabled>
									<span class="h6">PARTICIPATED</span>
								</button>`;
								swal('Participated Successfully...','','success');		
							}
						},
						error : function(xhr, status, err){
							swal(xhr.responseJSON.message,'', 'error');
						}
					});
			  	} 
			});
		}
	}

	function post_feedback(){
		const _token = $('[name="_token"]').val();
		if(isLogged()){
			const feedback = $("[name='feedback']").val();
			$.ajax({
				url : '/feedback',
				method : 'POST',
				data : {_token, event:`{{event._id}}`, feedback},
				success : function(res){					
					const name = `{{logged_person_name}}`;
					var bg_dark = 'bg-dark';
					var text_light = 'text-light';
					if(`{{student}}`=='true'){
						bg_dark = '';
						text_light = '';
					}
					const feedback_html = `						
						<div class="col-lg-4 col-md-4 col-sm-6 col-12">
							<div class="shadow-sm border rounded m-1 mb-4 overflow-auto" style="height:200px;">
								<p class="h5 p-3 ${bg_dark} ${text_light} border-bottom">${name}</p>
								<p class="px-4" style="line-height:30px;">${feedback}</p>
							</div>					
						</div>
					`;
					$('.feedback').prepend(feedback_html);
					$("[name='feedback']").val('');
					swal('Post Successfully...','','success');
				},
				error : function(xhr, status, err){
					swal(xhr.responseJSON.message,'', 'error');
				}
			});			
		}
	}

	function be_volunteer(event_id){
		const _token = $('[name="_token"]').val();
		const event = event_id;
		const btn = temp;
		if(isLogged()){
			swal({
			  	title: "Are you sure?",
			  	icon: "warning",
			  	buttons: true
			})
			.then((res)=>{
				if(res){
					$.ajax({
						url : '/member',
						method : "POST",
						data : {_token, event},
						success : function(res){
							btn.parentElement.outerHTML = `
							<button class="btn btn-warning" disabled>
								<span class="h6">PENDING</span>
							</button>`;
							$('.volunteer_request_popup').addClass('d-none');
							$('.random').removeClass('backlight');
							$('body').css({'heigh':'auto', 'overflow':'auto'});
							swal('Request sent successfully...','','success');		
						},
						error : function(xhr, status, err){
							swal(xhr.responseJSON.message,'', 'error');
						}
					});
				}				
			});
		}
	}


</script>